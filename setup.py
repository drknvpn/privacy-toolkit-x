#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import os
import sys
import subprocess
from setuptools import setup, find_packages

def check_dependencies():
    """Проверка и установка системных зависимостей"""
    required = [
        'python3',
        'python3-pip',
        'tor',
        'network-manager',
        'net-tools',
        'udisks2'
    ]
    
    print("[*] Установка системных зависимостей...")
    try:
        subprocess.run(['sudo', 'apt', 'update'], check=True)
        subprocess.run(['sudo', 'apt', 'install', '-y'] + required, check=True)
    except subprocess.CalledProcessError:
        print("[!] Ошибка установки зависимостей!")
        sys.exit(1)

def install_python_packages():
    """Установка Python-пакетов"""
    packages = [
        'psutil',
        'pyudev',
        'pyautogui',
        'scapy',
        'cryptography',
        'pillow',
        'pyexiv2',
        'requests',
        'pyyaml'
    ]
    
    print("[*] Установка Python-пакетов...")
    try:
        subprocess.run(['pip3', 'install'] + packages, check=True)
    except subprocess.CalledProcessError:
        print("[!] Ошибка установки Python-пакетов!")
        sys.exit(1)

def create_config():
    """Создание конфигурационного файла"""
    config = {
        'auto_clean': True,
        'killswitch': False,
        'paranoid_mode': False,
        'log_level': 'INFO'
    }
    
    config_path = '/etc/privacy_toolkit/config.yaml'
    os.makedirs(os.path.dirname(config_path), exist_ok=True)
    
    try:
        import yaml
        with open(config_path, 'w') as f:
            yaml.dump(config, f)
        print(f"[*] Конфиг создан: {config_path}")
    except Exception as e:
        print(f"[!] Ошибка создания конфига: {e}")

if __name__ == "__main__":
    print("""    
██████╗░██████╗░██╗██╗░░░██╗░█████╗░░█████╗░██╗░░░██╗░░░░░░████████╗░█████╗░░█████╗░██╗░░░░░██╗░░██╗██╗████████╗░░░░░░██╗░░██╗
██╔══██╗██╔══██╗██║██║░░░██║██╔══██╗██╔══██╗╚██╗░██╔╝░░░░░░╚══██╔══╝██╔══██╗██╔══██╗██║░░░░░██║░██╔╝██║╚══██╔══╝░░░░░░╚██╗██╔╝
██████╔╝██████╔╝██║╚██╗░██╔╝███████║██║░░╚═╝░╚████╔╝░█████╗░░░██║░░░██║░░██║██║░░██║██║░░░░░█████═╝░██║░░░██║░░░█████╗░╚███╔╝░
██╔═══╝░██╔══██╗██║░╚████╔╝░██╔══██║██║░░██╗░░╚██╔╝░░╚════╝░░░██║░░░██║░░██║██║░░██║██║░░░░░██╔═██╗░██║░░░██║░░░╚════╝░██╔██╗░
██║░░░░░██║░░██║██║░░╚██╔╝░░██║░░██║╚█████╔╝░░░██║░░░░░░░░░░░░██║░░░╚█████╔╝╚█████╔╝███████╗██║░╚██╗██║░░░██║░░░░░░░░░██╔╝╚██╗
╚═╝░░░░░╚═╝░░╚═╝╚═╝░░░╚═╝░░░╚═╝░░╚═╝░╚════╝░░░░╚═╝░░░░░░░░░░░░╚═╝░░░░╚════╝░░╚════╝░╚══════╝╚═╝░░╚═╝╚═╝░░░╚═╝░░░░░░░░░╚═╝░░╚═╝

░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
█████╗█████╗█████╗█████╗█████╗█████╗█████╗█████╗█████╗█████╗█████╗█████╗█████╗█████╗█████╗█████╗█████╗█████╗█████╗█████╗█████╗
╚════╝╚════╝╚════╝╚════╝╚════╝╚════╝╚════╝╚════╝╚════╝╚════╝╚════╝╚════╝╚════╝╚════╝╚════╝╚════╝╚════╝╚════╝╚════╝╚════╝╚════╝
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░

██████╗░███████╗░██████╗████████╗  ██╗███╗░░██╗  ██████╗░███████╗░█████╗░░█████╗░███████╗
██╔══██╗██╔════╝██╔════╝╚══██╔══╝  ██║████╗░██║  ██╔══██╗██╔════╝██╔══██╗██╔══██╗██╔════╝
██████╔╝█████╗░░╚█████╗░░░░██║░░░  ██║██╔██╗██║  ██████╔╝█████╗░░███████║██║░░╚═╝█████╗░░
██╔══██╗██╔══╝░░░╚═══██╗░░░██║░░░  ██║██║╚████║  ██╔═══╝░██╔══╝░░██╔══██║██║░░██╗██╔══╝░░
██║░░██║███████╗██████╔╝░░░██║░░░  ██║██║░╚███║  ██║░░░░░███████╗██║░░██║╚█████╔╝███████╗
╚═╝░░╚═╝╚══════╝╚═════╝░░░░╚═╝░░░  ╚═╝╚═╝░░╚══╝  ╚═╝░░░░░╚══════╝╚═╝░░╚═╝░╚════╝░╚══════╝

██████╗░░█████╗░░██████╗██╗░░██╗░█████╗░  ████████╗███████╗░█████╗░██╗░░██╗███╗░░██╗██╗░██████╗░██╗░░░██╗███████╗
██╔══██╗██╔══██╗██╔════╝██║░░██║██╔══██╗  ╚══██╔══╝██╔════╝██╔══██╗██║░░██║████╗░██║██║██╔═══██╗██║░░░██║██╔════╝
██████╔╝███████║╚█████╗░███████║███████║  ░░░██║░░░█████╗░░██║░░╚═╝███████║██╔██╗██║██║██║██╗██║██║░░░██║█████╗░░
██╔═══╝░██╔══██║░╚═══██╗██╔══██║██╔══██║  ░░░██║░░░██╔══╝░░██║░░██╗██╔══██║██║╚████║██║╚██████╔╝██║░░░██║██╔══╝░░
██║░░░░░██║░░██║██████╔╝██║░░██║██║░░██║  ░░░██║░░░███████╗╚█████╔╝██║░░██║██║░╚███║██║░╚═██╔═╝░╚██████╔╝███████╗
╚═╝░░░░░╚═╝░░╚═╝╚═════╝░╚═╝░░╚═╝╚═╝░░╚═╝  ░░░╚═╝░░░╚══════╝░╚════╝░╚═╝░░╚═╝╚═╝░░╚══╝╚═╝░░░╚═╝░░░░╚═════╝░╚══════╝   
    """)
    
    # Проверка прав
    if os.geteuid() != 0:
        print("[!] Требуются права root! Запустите с sudo.")
        sys.exit(1)
    
    check_dependencies()
    install_python_packages()
    create_config()
    
    # Установка основного скрипта
    setup(
        name='privacy_toolkit',
        version='1.0',
        description='Advanced privacy protection toolkit',
        author='Security Team',
        packages=find_packages(),
        scripts=['privacy_toolkit.py'],
        data_files=[
            ('/etc/privacy_toolkit', ['config.yaml']),
            ('/var/log/privacy_toolkit', [])
        ],
        entry_points={
            'console_scripts': [
                'priv-toolkit=privacy_toolkit:main'
            ]
        }
    )
    
    print("\n[+] Установка успешно завершена!")
    print("    Запуск: sudo priv-toolkit")
